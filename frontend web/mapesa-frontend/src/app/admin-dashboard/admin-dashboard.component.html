<div class="dashboard-container">
  <!-- Loading Spinner -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner">Loading...</div>
  </div>

  <!-- Error Message -->
  <div class="error-banner" *ngIf="error">
    <div class="error-content">
      <span>{{ error }}</span>
      <button (click)="loadAllData()" class="retry-btn">Retry</button>
    </div>
  </div>

  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polygon points="10,8 16,12 10,16 10,8"></polygon>
        </svg>
        <h3>Admin Panel</h3>
      </div>
    </div>
    
    <ul class="sidebar-nav">
      <li class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="setActiveTab('dashboard')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        </svg>
        Dashboard
      </li>
      <li class="nav-item" [class.active]="activeTab === 'users'" (click)="setActiveTab('users')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        Users ({{ users.length }})
      </li>
      <li class="nav-item" [class.active]="activeTab === 'reporters'" (click)="setActiveTab('reporters')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Reporters ({{ reporters.length }})
      </li>
      <li class="nav-item" [class.active]="activeTab === 'drivers'" (click)="setActiveTab('drivers')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6"></path>
          <path d="M6.3 6.3l4.24 4.24m4.24 4.24l4.24 4.24"></path>
        </svg>
        Drivers ({{ drivers.length }})
      </li>
      <li class="nav-item" [class.active]="activeTab === 'cars'" (click)="setActiveTab('cars')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10H5.6L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"></path>
          <circle cx="7" cy="17" r="2"></circle>
          <path d="M9 17h6"></path>
          <circle cx="17" cy="17" r="2"></circle>
        </svg>
        Cars ({{ cars.length }})
      </li>
      <li class="nav-item" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        Emergency Reports
        <span class="badge" *ngIf="dashboardStats.pendingReports > 0">{{dashboardStats.pendingReports}}</span>
      </li>
      <li class="nav-item" [class.active]="activeTab === 'locations'" (click)="setActiveTab('locations')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        Driver Locations
      </li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <h1>{{getPageTitle()}}</h1>
      </div>
      <div class="header-right">
        <div class="notification-bell">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="notification-count" *ngIf="notifications > 0">{{notifications}}</span>
        </div>
        <div class="user-profile">
          <img src="https://ui-avatars.com/api/?name=Admin&background=4f46e5&color=fff" alt="Admin">
          <span>Admin</span>
        </div>
        <button class="btn btn-logout" (click)="logout()">Logout</button>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="content-area" *ngIf="activeTab === 'dashboard'">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon users">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="stat-info">
            <h3>{{dashboardStats.totalUsers}}</h3>
            <p>Total Users</p>
            <small>Including all roles</small>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon drivers">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6"></path>
            </svg>
          </div>
          <div class="stat-info">
            <h3>{{dashboardStats.activeDrivers}}</h3>
            <p>Active Drivers</p>
            <small>Currently on duty</small>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon cars">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10H5.6L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"></path>
              <circle cx="7" cy="17" r="2"></circle>
              <circle cx="17" cy="17" r="2"></circle>
            </svg>
          </div>
          <div class="stat-info">
            <h3>{{dashboardStats.availableCars}}</h3>
            <p>Available Cars</p>
            <small>Ready for dispatch</small>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon reports">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
          </div>
          <div class="stat-info">
            <h3>{{dashboardStats.pendingReports}}</h3>
            <p>Pending Reports</p>
            <small>Awaiting review</small>
          </div>
        </div>
      </div>

      <!-- Recent Activity Section -->
      <div class="recent-activity">
        <h3>Recent Activity</h3>
        <div class="activity-list">
          <div class="activity-item">
            <div class="activity-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="activity-content">
              <p><strong>{{ users.length }}</strong> total users registered</p>
              <small>System overview</small>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10H5.6L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"></path>
                <circle cx="7" cy="17" r="2"></circle>
                <circle cx="17" cy="17" r="2"></circle>
              </svg>
            </div>
            <div class="activity-content">
              <p><strong>{{ cars.length }}</strong> vehicles in fleet</p>
              <small>Fleet management</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Management -->
    <div class="content-area" *ngIf="activeTab === 'users'">
      <div class="table-header">
        <!-- <button class="btn btn-primary" (click)="openModal('user')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add User
        </button> -->
        <div class="search-box">
          <input type="text" placeholder="Search users..." [(ngModel)]="searchTerm" (input)="onSearchChange()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
        </div>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Role</th>
              <th>Status</th>
              <th>License</th>
              <th>Address</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers; let i = index">
              <td>{{user.id}}</td>
              <td>{{getDisplayName(user)}}</td>
              <td>{{user.email}}</td>
              <td>{{user.phoneNumber}}</td>
              <td><span class="role-badge" [class]="getRoleClass(user.roles ?? '')">{{user.roles}}</span></td>
              <td><span class="status-badge" [class]="getStatusClass(user.status ?? '')">{{user.status}}</span></td>
              <td>{{user.licenseNumber || 'N/A'}}</td>
              <td>{{user.address || 'Not specified'}}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-action edit" (click)="editItem('user', user)" title="Edit User">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-action delete" (click)="deleteItem('user', user.id)" title="Delete User">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="9" class="no-data">
                <div class="no-data-message">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <p>No users found</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Reporters Management -->
    <div class="content-area" *ngIf="activeTab === 'reporters'">
      <div class="table-header">
        <button class="btn btn-primary" (click)="openModal('reporter')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Reporter
        </button>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Address</th>
              <th>Status</th>
              <th>Region ID</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reporter of reporters">
              <td>{{reporter.id}}</td>
              <td>{{getDisplayName(reporter)}}</td>
              <td>{{reporter.email}}</td>
              <td>{{reporter.phoneNumber}}</td>
              <td>{{reporter.address || 'Not specified'}}</td>
              <td><span class="status-badge" [class]="getStatusClass(reporter.status ?? '')">{{reporter.status}}</span></td>
              <td>{{reporter.regionId}}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-action edit" (click)="editItem('reporter', reporter)" title="Edit Reporter">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-action delete" (click)="deleteItem('reporter', reporter.id)" title="Delete Reporter">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="reporters.length === 0">
              <td colspan="8" class="no-data">
                <div class="no-data-message">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                  </svg>
                  <p>No reporters found</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Drivers Management -->
    <div class="content-area" *ngIf="activeTab === 'drivers'">
      <div class="table-header">
        <button class="btn btn-primary" (click)="openModal('driver')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Driver
        </button>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>License Number</th>
              <th>Address</th>
              <th>Car ID</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let driver of drivers">
              <td>{{driver.id}}</td>
              <td>{{getDisplayName(driver)}}</td>
              <td>{{driver.email}}</td>
              <td>{{driver.phoneNumber}}</td>
              <td>{{driver.licenseNumber || 'Not specified'}}</td>
              <td>{{driver.address || 'Not specified'}}</td>
              <td>{{driver.carId || 'Not assigned'}}</td>
              <td><span class="status-badge" [class]="getStatusClass(driver.status ?? '')">{{driver.status}}</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn-action edit" (click)="editItem('driver', driver)" title="Edit Driver">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-action delete" (click)="deleteItem('driver', driver.id)" title="Delete Driver">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="drivers.length === 0">
              <td colspan="9" class="no-data">
                <div class="no-data-message">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6"></path>
                  </svg>
                  <p>No drivers found</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Cars Management -->
    <div class="content-area" *ngIf="activeTab === 'cars'">
      <div class="table-header">
        <button class="btn btn-primary" (click)="openModal('car')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Car
        </button>
      </div>
      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Plate Number</th>
              <th>Model</th>
              <th>Color</th>
              <th>Driver</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let car of cars">
              <td>{{car.id}}</td>
              <td><strong>{{car.plateNumber}}</strong></td>
              <td>{{car.model}}</td>
              <td>
                <span class="color-indicator" [style.background-color]="car.color.toLowerCase()"></span>
                {{car.color}}
              </td>
              <td>{{car.driver || 'Unassigned'}}</td>
              <td><span class="status-badge" [class]="getStatusClass(car.status || 'unknown')">{{car.status || 'Unknown'}}</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn-action edit" (click)="editItem('car', car)" title="Edit Car">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-action delete" (click)="deleteItem('car', car.id)" title="Delete Car">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="cars.length === 0">
              <td colspan="7" class="no-data">
                <div class="no-data-message">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10H5.6L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"></path>
                    <circle cx="7" cy="17" r="2"></circle>
                    <circle cx="17" cy="17" r="2"></circle>
                  </svg>
                  <p>No cars found</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Emergency Reports -->
    <div class="content-area" *ngIf="activeTab === 'reports'">
      <div class="reports-grid">
        <div class="report-card" *ngFor="let report of emergencies" [class]="report.emergency.status">
          <div class="report-header">
            <div class="report-id">#{{report.emergency.id}}</div>
          <div class="report-priority" [class]="getPriorityClass(report.emergency.priority)">
              {{report.emergency.priority | titlecase}}
            </div>
          </div>
          <div class="report-content">
            <h4>{{report.emergency.type}}</h4>
            <p>{{report.emergency.description}}</p>
            <div class="report-meta">
              <div class="meta-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span><strong>Reporter:</strong> {{report.reporter.firstName}} {{report.reporter.lastName}}</span>
              </div>
              <div class="meta-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span><strong>Location:</strong> {{report.emergency.locationDescription}}</span>
              </div>
              <div class="meta-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12,6 12,12 16,14"></polyline>
                </svg>
                <span><strong>Time:</strong> {{report.emergency.reportedAt | date:'short'}}</span>
              </div>
            </div>
          </div>
          <div class="report-actions" *ngIf="report.emergency.status === 'PENDING'">
            <select [(ngModel)]="selectedDriverId[report.emergency.id]">
              <option value="" disabled>Select a driver</option>
              <option *ngFor="let driver of availableDrivers" [value]="driver.id">
                {{driver.firstName}} {{driver.lastName}}
              </option>
            </select>
            <div class="report-actions-buttons">
              <button class="btn btn-success" (click)="assignAndApproveReport(report.emergency.id, selectedDriverId[report.emergency.id])" [disabled]="!selectedDriverId[report.emergency.id]">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
                Assign & Approve
              </button>
              <button class="btn btn-danger" (click)="rejectReport(report.emergency.id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Reject
              </button>
            </div>
          </div>
          <div class="report-status" *ngIf="report.emergency.status !== 'PENDING'">
            <span class="status-badge" [class]="getStatusClass(report.emergency.status ?? '')">{{report.emergency.status | titlecase}}</span>
            <span *ngIf="report.driver" class="assigned-driver">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6"></path>
              </svg>
              Assigned to: {{report.driver.firstName}} {{report.driver.lastName}}
            </span>
          </div>
        </div>
        <div *ngIf="emergencies.length === 0" class="no-reports">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <h3>No Emergency Reports</h3>
          <p>All reports have been processed</p>
        </div>
      </div>
    </div>

    <!-- Driver Locations -->
    <div class="content-area" *ngIf="activeTab === 'locations'">
      <div class="location-container">
        <div class="map-placeholder">
          <div class="map-controls">
            <button class="btn btn-secondary" (click)="refreshLocations()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23,4 23,10 17,10"></polyline>
                <polyline points="1,20 1,14 7,14"></polyline>
                <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"></path>
              </svg>
              Refresh Locations
            </button>
            <div class="location-stats">
              <span>{{activeDrivers.length}} drivers active</span>
              <span>Last updated: {{activeDrivers[0]?.lastUpdate || 'Never'}}</span>
            </div>
          </div>
          <div class="map-content">
            <h3>Live Driver Locations</h3>
            <p>Interactive map showing real-time driver positions</p>
            <!-- This would be replaced with actual map component -->
            <div class="driver-pins">
              <div class="driver-pin" *ngFor="let driver of activeDrivers" 
                   [style.left.%]="driver.mapX" 
                   [style.top.%]="driver.mapY">
                <div class="pin-marker" [class]="getStatusClass(driver.status ?? '')"></div>
                <div class="pin-info">
                  <strong>{{driver.name}}</strong>
                  <span>{{driver.status | titlecase}}</span>
                  <small>{{driver.lastUpdate}}</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="drivers-list">
          <h3>Active Drivers ({{activeDrivers.length}})</h3>
          <div class="driver-item" *ngFor="let driver of activeDrivers">
            <div class="driver-avatar">
              <img [src]="driver.avatar" [alt]="driver.name">
              <div class="status-indicator" [class]="getStatusClass(driver.status ?? '')"></div>
            </div>
            <div class="driver-info">
              <h4>{{driver.name}}</h4>
              <p>{{driver.location}}</p>
              <small>Last update: {{driver.lastUpdate}}</small>
              <div class="contact-info">
                <span>üì± {{driver.phone}}</span>
                <span>‚úâÔ∏è {{driver.email}}</span>
              </div>
            </div>
            <div class="driver-actions">
              <button class="btn btn-sm btn-primary" (click)="contactDriver(driver.id)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                Contact
              </button>
            </div>
          </div>
          <div *ngIf="activeDrivers.length === 0" class="no-drivers">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6"></path>
            </svg>
            <p>No active drivers</p>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal for Add/Edit -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{modalTitle}}</h3>
      <button class="close-btn" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveItem()">
        <!-- User/Reporter/Driver Form -->
        <div class="form-grid" *ngIf="modalType === 'user' || modalType === 'reporter' || modalType === 'driver'">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input id="firstName" type="text" [(ngModel)]="currentItem.firstName" name="firstName" required>
          </div>
          <div class="form-group">
            <label for="middleName">Middle Name</label>
            <input id="middleName" type="text" [(ngModel)]="currentItem.middleName" name="middleName">
          </div>
          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input id="lastName" type="text" [(ngModel)]="currentItem.lastName" name="lastName" required>
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input id="email" type="email" [(ngModel)]="currentItem.email" name="email" required>
          </div>
          <div class="form-group">
            <label for="phoneNumber">Phone Number *</label>
            <input id="phoneNumber" type="tel" [(ngModel)]="currentItem.phoneNumber" name="phoneNumber" required>
          </div>
          <div class="form-group">
            <label for="address">Address</label>
            <input id="address" type="text" [(ngModel)]="currentItem.address" name="address">
          </div>
          <div class="form-group" *ngIf="modalType === 'driver'">
            <label for="licenseNumber">License Number *</label>
            <input id="licenseNumber" type="text" [(ngModel)]="currentItem.licenseNumber" name="licenseNumber" required>
          </div>
          <div class="form-group" *ngIf="modalType === 'driver'">
            <label for="carId">Car ID</label>
            <select id="carId" [(ngModel)]="currentItem.carId" name="carId">
              <option value="0">No car assigned</option>
              <option *ngFor="let car of cars" [value]="car.id">{{car.plateNumber}} - {{car.model}}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" [(ngModel)]="currentItem.status" name="status" required>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="available" *ngIf="modalType === 'driver'">Available</option>
              <option value="on-trip" *ngIf="modalType === 'driver'">On Trip</option>
            </select>
          </div>
          <div class="form-group">
            <label for="regionId">Region ID</label>
            <input id="regionId" type="number" [(ngModel)]="currentItem.regionId" name="regionId" min="1">
          </div>
        </div>

        <!-- Car Form -->
        <div class="form-grid" *ngIf="modalType === 'car'">
          <div class="form-group">
            <label for="plateNumber">Plate Number *</label>
            <input id="plateNumber" type="text" [(ngModel)]="currentItem.plateNumber" name="plateNumber" required>
          </div>
          <div class="form-group">
            <label for="model">Model *</label>
            <input id="model" type="text" [(ngModel)]="currentItem.model" name="model" required>
          </div>
          <div class="form-group">
            <label for="color">Color *</label>
            <input id="color" type="text" [(ngModel)]="currentItem.color" name="color" required>
          </div>
          <div class="form-group">
            <label for="driver">Assign Driver</label>
            <select id="driver" [(ngModel)]="currentItem.driver" name="driver">
              <option value="">Select Driver</option>
              <option *ngFor="let driver of availableDrivers" [value]="getDisplayName(driver)">
                {{getDisplayName(driver)}} - {{driver.licenseNumber}}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="carStatus">Status</label>
            <select id="carStatus" [(ngModel)]="currentItem.status" name="status" required>
              <option value="available">Available</option>
              <option value="in-use">In Use</option>
              <option value="maintenance">Maintenance</option>
              <option value="out-of-service">Out of Service</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()" [disabled]="loading">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <span *ngIf="loading" class="loading-spinner"></span>
            {{isEditing ? 'Update' : 'Create'}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Confirm Action</h3>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="warning-icon">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
    </div>
    <div class="modal-body">
      <p>{{confirmMessage}}</p>
      <p class="warning-text">This action cannot be undone.</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="closeConfirmModal()" [disabled]="loading">
        Cancel
      </button>
      <button type="button" class="btn btn-danger" (click)="confirmAction()" [disabled]="loading">
        <span *ngIf="loading" class="loading-spinner"></span>
        Confirm Delete
      </button>
    </div>
  </div>
</div>
